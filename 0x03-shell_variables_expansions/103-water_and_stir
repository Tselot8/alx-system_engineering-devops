#!/bin/bash

BASE_WATER="water"
BASE_STIR="stir."
BASE_BESTCHOL="bestchol"

char_index() {
    local char="$1"
    local base="$2"
    local i
    for ((i=0; i<${#base}; i++)); do
        if [[ "${base:$i:1}" == "$char" ]]; then
            echo "$i"
            return
        fi
    done
    echo "-1"
}

base_to_dec() {
    local num="$1"
    local base="$2"
    local dec=0
    local b=${#base}
    local i ch idx
    for ((i=0; i<${#num}; i++)); do
        ch="${num:$i:1}"
        idx=$(char_index "$ch" "$base")
        if [ "$idx" = "-1" ]; then
            echo "Invalid character '$ch' for base '$base'" >&2
            exit 1
        fi
        dec=$(( dec * b + idx ))
    done
    echo "$dec"
}

dec_to_base() {
    local dec="$1"
    local base="$2"
    local b=${#base}
    local out=""
    if [ "$dec" -eq 0 ]; then
        echo "${base:0:1}"
        return
    fi
    while [ "$dec" -gt 0 ]; do
        local r=$(( dec % b ))
        out="${base:$r:1}${out}"
        dec=$(( dec / b ))
    done
    echo "$out"
}

w_dec=$(base_to_dec "$WATER" "$BASE_WATER")
s_dec=$(base_to_dec "$STIR" "$BASE_STIR")
sum=$(( w_dec + s_dec ))
result=$(dec_to_base "$sum" "$BASE_BESTCHOL")
echo "$result"
